#!/usr/bin/env python3

import json
from sys import argv
from os import chdir

path = '.' if len(argv) <= 1 else argv[1]
chdir(path)

try: # for pip >= 10
    from pip._internal.req import parse_requirements
except ImportError: # for pip <= 9.0.3
    from pip.req import parse_requirements

deps = parse_requirements('requirements.txt', session="_")

dependencies = {}

for dependency in deps:
    if hasattr(dependency.req, 'key'):
      dependencies[dependency.req.key] = str(dependency.req.specifier)
    else:
      dependencies[dependency.req.name] = str(dependency.req.specifier)

print(json.dumps(dependencies))
